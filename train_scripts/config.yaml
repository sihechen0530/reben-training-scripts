job:
  name: bigearthnet-ft
  # partition/queue 名：有的集群叫 partition，有的叫 qos，按需删改
  partition: gpu
  qos: normal          # 如无用，删掉即可
  account: liu.guoy   # 若集群要求记账账号
  time: "04:00:00"     # HH:MM:SS
  nodes: 1
  gres: "gpu:a100:1"     # GPU 资源规格（匹配你的 srun 命令）
  cpus_per_task: 8
  mem: "32G"
  mail_user: "you@university.edu"
  mail_type: "END,FAIL"        # 可选：BEGIN, END, FAIL, REQUEUE, ALL
  chdir: "/home/liu.guoy/reben-training-scripts/scripts"   # 作业工作目录
  output_dir: "../ckpt_logs"           # 统一的 ckpt+log 输出目录（相对 chdir）

env:
  # 训练脚本所需的环境变量（可选）
  OMP_NUM_THREADS: 8
  TOKENIZERS_PARALLELISM: "false"
  # HF_TOKEN: ""  # Required for DINOv3 models (gated models on HuggingFace)

data:
  # BigEarthNet v2.0 数据集路径配置
  benv2_data_dir: "/scratch/chen.sihe1"

train:
  script: "train_BigEarthNetv2_0.py"
  use_multimodal: false        # Use multimodal pipeline even when running RGB-only DINOv3
  multimodal_script: "train_multimodal.py"
  python: "python"   # 或 "python3"
  # 传给 train_BigEarthNetv2_0.py 的参数（会转换为 --k v）
  args:
    architecture: "resnet101"
    bandconfig: "rgb"
    config: "../train_scripts/config.yaml"
  # 单独给多模态训练脚本的默认参数，只有 use_multimodal: true 时才会被使用
  multimodal_args:
    architecture: "dinov3-small"
    seed: 42
    lr: 0.0001
    epochs: 100
    bs: 512
    drop_rate: 0.15
    warmup: 1000
    workers: 8
    use_wandb: false
    bandconfig: "rgb"
    dinov3_hidden_size: 384   # 384/768/1024/1536 -> s/b/l/g
    dinov3_pretrained: true
    dinov3_freeze: true
    dinov3_lr: 0.0
    resnet_pretrained: false
    resnet_freeze: true
    resnet_lr: 0.0
    resnet_resume_from: null  # 绝对路径或相对 scripts/ 的路径，用于加载已有 ResNet backbone
    no_resnet: true
    # 特征融合策略 (Fusion Strategy)
    # 可选值：
    #   - "concat": 简单拼接，输出维度 = 所有输入维度之和（默认）
    #   - "weighted": 加权求和，使用可学习的权重，输出维度 = 最大输入维度
    #   - "linear_projection": 线性投影后求和，需要设置 output_dim 参数
    #   - "attention": 注意力机制融合，支持多头注意力，需要设置 output_dim 和 num_heads 参数
    #   - "bilinear": 双线性池化融合（仅支持2个backbone），需要设置 output_dim，推荐使用 use_low_rank=True
    #   - "gated": 门控融合，使用可学习的门控机制，需要设置 output_dim 参数
    fusion_type: "concat"
    # fusion_type 相关参数（仅当需要时使用）
    # fusion_output_dim: 512  # 用于 linear_projection, attention, bilinear, gated
    # fusion_num_heads: 4     # 用于 attention，多头注意力的头数
    # fusion_use_low_rank: true  # 用于 bilinear，是否使用低秩近似（推荐）
    
    # 分类器类型 (Classifier Type)
    # 可选值：
    #   - "linear": 线性分类器（默认），适用于大多数情况
    #   - "mlp": 多层感知机分类器，需要设置 hidden_dim 参数
    #   - "svm": SVM风格分类器，支持hinge loss，适合线性可分问题
    #   - "labelwise_binary": 标签级别的二分类器，每个类别独立二分类，适用于多标签分类
    classifier_type: "linear"
    # classifier_type 相关参数（仅当需要时使用）
    # classifier_hidden_dim: 512  # 用于 mlp，隐藏层维度
    # classifier_shared_backbone: true  # 用于 labelwise_binary，是否共享特征提取器

    use_s1: false
    config: "../train_scripts/config.yaml"

  # 作业数组（超参搜索）——任选一种：
  sweep:
    # 方式1：笛卡尔积网格（submit.py 自动展开）
    grid:
      lr: [0.001, 0.0001, 0.00005]
    # 方式2：从文件读取 N 行配置（与数组索引对应）
    # list_file: "sweeps.txt"
